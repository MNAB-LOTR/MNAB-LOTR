<!DOCTYPE html>
<html lang="nl-BE">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title || 'Favorieten' %></title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/logged-in.js"></script>
  </head>
  <body>
    <header class="header-">
      <h1 class="quiz-name"><a href="/home" class="return-home">The one</a></h1>
      <aside class="account-overview">
        <a class="account-status" onclick="toggleMenu(event)">â˜°</a>
        <ul class="account-menu">
          <li><a href="/home">Home</a></li>
          <li>
            <a href="#" onclick="toggleSubMenu('quiz-options')">Quiz</a>
            <ul class="sub-menu quiz-options">
              <li><a href="/ten-rounds">Ten rounds</a></li>
              <li><a href="/sudden-death">Sudden death</a></li>
            </ul>
          </li>
          <li>
            <a href="#" onclick="toggleSubMenu('quotes-options')">Quotes</a>
            <ul class="sub-menu quotes-options">
              <li><a href="/favorites">Favorites</a></li>
              <li><a href="/blacklist">Blacklist</a></li>
            </ul>
          </li>
          <li><a href="/login">Uitloggen</a></li>
        </ul>
      </aside>
    </header>

    <main class="mainblack-fav">
      <section class="title-container">
        <h2><strong>Favorieten</strong></h2>
        <a
          href="/favorites/download"
          class="download-btn"
          id="download-btn"
          download
        >
          <img
            src="https://cdn-icons-png.flaticon.com/512/3502/3502477.png"
            alt="Download"
          />
        </a>
      </section>
      <ul>
        <section class="quote-container">
          <% if (favoriteEntries.length === 0) { %>
          <li>Geen favoriete quotes gevonden.</li>
          <% } else { %> <% favoriteEntries.forEach(function(entry) { %>
          <li>
            <p>"<%= entry.quote %>"</p>
             <p><strong>Personage:</strong> <a class="link-personage" href="https://lotr.fandom.com/wiki/<%= entry.character %>" target="_blank"><%= entry.character %></a></p>
            <p>
            <a
              href="#"
              class="delete-quote"
              data-quote="<%- encodeURIComponent(entry.quote) %>"
              data-character="<%- encodeURIComponent(entry.character) %>"
            >
              ðŸ—‘
            </a>
          </li>
          <% }); %> <% } %>
        </section>
      </ul>
    </main>

    <footer class="footer">
      <p>Â© 2025 MNAB</p>
    </footer>
  </body>
</html>

<script>
  document.querySelectorAll(".delete-quote").forEach(function (btn) {
    btn.addEventListener("click", function (e) {
      e.preventDefault();

      const li = btn.closest("li");
      const encodedQuote = btn.getAttribute("data-quote");
      const encodedCharacter = btn.getAttribute("data-character");

      const quoteText = decodeURIComponent(encodedQuote);
      const characterText = decodeURIComponent(encodedCharacter);

      fetch("/favorites/delete", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ quote: quoteText, character: characterText }),
      })
        .then((res) => {
          if (!res.ok) throw new Error("Kon quote niet verwijderen");
          return res;
        })
        .then(() => {
          li.remove();
        })
        .catch((err) => alert(err.message));
    });
  });
</script>
